<root>
	<panel name="date" modes="host">
		<class>chattime</class>
		<bounds>10,100,240,90</bounds>
		<dynamic />
		<locked />
	</panel>
	
	<windowclass name="chattime">
		<frame>groupbox</frame>
		<size width="230" height="90" />
		<placement>
			<position>
				<x>10</x>
				<y>30</y>
			</position>
		</placement>		
		<sizelimits>
			<size width="230" height="90" />
			<!--<dynamic /> -->
		</sizelimits>		
		<noclose />
		<sheetdata>
			
			<label name="currenthour">
				<anchored position="insidetopleft" width="20">
					<left anchor="left" offset="20" />
					<top offset="8" />
				</anchored>
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<font>calendarbold</font>
				<color>000000</color>
				<center />
				<tooltip textres="desktop_currenthour_tooltip" />
				<script>
					function onInit()
						if DB.getValue("calendar.newcampaign") == nil or DB.getValue("calendar.newcampaign") == 0 then
												
							local nYear = DB.getValue("calendar.current.year", 0);
							if nYear == nil or nYear == 0 then
								DB.setValue("calendar.current.year", "number", 1);
							end
							local nMonth = DB.getValue("calendar.current.month", 0);
							if nMonth == nil or nMonth == 0 then
								DB.setValue("calendar.current.month", "number", 1);
							end
							local nDay = DB.getValue("calendar.current.day", 0);
							if nDay == nil or nDay == 0 then
								DB.setValue("calendar.current.day", "number", 1);
							end
							local nMinute = DB.getValue("calendar.current.minute", 0);
							if nMinute == nil then
								DB.setValue("calendar.current.minute", "number", 0);
							end
							local nHour = DB.getValue("calendar.current.hour", 0);
							if nHour == nil then
								DB.setValue("calendar.current.hour", "number", 0);
							end
							Interface.openWindow("calendar", "DB");
							DB.setValue("calendar.newcampaign", "number", 1);
						end
						DB.addHandler("calendar.current.hour", "onUpdate", onSourceChanged);
						onSourceChanged();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
					
					function onClose()
						DB.removeHandler("calendar.current.hour", "onUpdate", onSourceChanged);
					end
					
					function onSourceChanged()
						local nHour, sPhase = CalendarManager.getDisplayHour();
						setValue(string.format("%2d", nHour));
						window.currentphase.setValue(sPhase);
					end
					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						CalendarManager.adjustHours(n);
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
						return true;
					end
				</script>
			</label>
			<label name="timesep">
				<anchored to="currenthour" position="righthigh" offset="5" />
				<color>FFFFFF</color>
				<static>:</static>
			</label>
			<label name="currentminute">
				<anchored to="timesep" position="righthigh" offset="6" width="20" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<tooltip textres="desktop_currentminute_tooltip" />
				<font>calendarbold</font>
				<color>000000</color>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler("calendar.current.minute", "onUpdate", onSourceChanged);
						onSourceChanged();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
					
					function onClose()
						DB.removeHandler("calendar.current.minute", "onUpdate", onSourceChanged);
					end
					
					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue("calendar.current.minute", 0)));
					end
					
					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						CalendarManager.adjustMinutes(n);
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
						return true;
					end
				</script>
			</label>
			<label name="currentphase">
				<anchored to="currentminute" position="righthigh" offset="5" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
			</label>
			<label name="currentday">
				<anchored to="currentphase" position="righthigh" offset="10" width="20" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<tooltip textres="desktop_currentday_tooltip" />
				<font>calendarbold</font>
				<color>000000</color>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler("calendar.current.day", "onUpdate", onSourceChanged);
						onSourceChanged();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
					
					function onClose()
						DB.removeHandler("calendar.current.day", "onUpdate", onSourceChanged);
					end
					
					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue("calendar.current.day", 0)));
					end
					
					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						CalendarManager.adjustDays(n);
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
						return true;
					end
				</script>
			</label>
			<label name="currentmonth">
				<anchored to="currentday" position="righthigh" offset="10" width="20" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<tooltip textres="desktop_currentmonth_tooltip" />
				<font>calendarbold</font>
				<color>000000</color>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler("calendar.current.month", "onUpdate", onSourceChanged);
						onSourceChanged();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
					
					function onClose()
						DB.removeHandler("calendar.current.month", "onUpdate", onSourceChanged);
					end
					
					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue("calendar.current.month", 0)));
					end
					
					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						CalendarManager.adjustMonths(n);
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
						return true;
					end
				</script>
			</label>
			<label name="currentyear">
				<anchored to="currentmonth" position="righthigh" offset="10" width="50" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<tooltip textres="desktop_currentyear_tooltip" />
				<font>calendarbold</font>
				<color>000000</color>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler("calendar.current.year", "onUpdate", onSourceChanged);
						onSourceChanged();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
					
					function onClose()
						DB.removeHandler("calendar.current.year", "onUpdate", onSourceChanged);
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
					
					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue("calendar.current.year", 0)));
					end
					
					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						CalendarManager.adjustYears(n);
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
						return true;
					end
				</script>
			</label>
			
			<number_ct_crosslink name="addhour" source="addhour">
				<anchored position="insidetopleft" width="20">
					<left anchor="left" offset="20" />
					<top offset="35" />
				</anchored>
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_addhour_tooltip" />
				<script>
					function onInit()
						DB.setValue(getDatabaseNode(), "addhour", "number", getValue());
					end
					function onClose()
						DB.setValue(getDatabaseNode(), "addhour", "number", getValue());
					end
					function onDoubleClick()
						Hour = window.addhour.getValue();
						
						CalendarManager.adjustHours(Hour);
						if window.checkweather.getValue() == 1 then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						if DB.getValue("calendar.check.day") == nil or DB.getValue("calendar.check.day") ~= DB.getValue("calendar.current.day") then
							CalendarManager.outputDate();
							DB.setValue("calendar.check.day", "number", DB.getValue("calendar.current.day"));
						end
						if Hour &gt; 0 then 
							CalendarManager.outputTime(); 
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)

					end
				</script>
			</number_ct_crosslink>
			<label name="timesep2">
				<anchored to="addhour" position="righthigh" offset="5" />
				<color>FFFFFF</color>
				<static>:</static>
			</label>
			<number_ct_crosslink name="addminute" source="addminute">
				<anchored to="timesep2" position="righthigh" offset="6" width="20" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_addminute_tooltip" />
				<script>
					function onInit()
						DB.setValue(getDatabaseNode(), "addminute", "number", getValue());
					end
					function onClose()
						DB.setValue(getDatabaseNode(), "addminute", "number", getValue());
					end
					function onDoubleClick()
						Minute = window.addminute.getValue();
						
						CalendarManager.adjustMinutes(Minute);
						if DB.getValue("calendar.check.day") == nil or DB.getValue("calendar.check.day") ~= DB.getValue("calendar.current.day") then
							CalendarManager.outputDate();
							DB.setValue("calendar.check.day", "number", DB.getValue("calendar.current.day"));
						end
						if Minute &gt; 0 then 
							CalendarManager.outputTime(); 
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
				</script>
			</number_ct_crosslink>
			
			<number_ct_crosslink name="addday" source="addday">
				<anchored to="addminute" position="righthigh" offset="38" width="20" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_addday_tooltip" />
				<script>
					function onInit()
						DB.setValue(getDatabaseNode(), "addday", "number", getValue());
					end
					function onClose()
						DB.setValue(getDatabaseNode(), "addday", "number", getValue());
					end
					
					function onDoubleClick()
						Day = window.addday.getValue();
						if window.checkweather.getValue() == 1 then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						if Day &gt; 0 then 
							CalendarManager.outputDate(); 
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
				</script>
			</number_ct_crosslink>
			<number_ct_crosslink name="addmonth" source="addmonth">
				<anchored to="addday" position="righthigh" offset="10" width="20" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_addmonth_tooltip" />
				<script>
					function onInit()
						DB.setValue(getDatabaseNode(), "addmonth", "number", getValue());
					end
					function onClose()
						DB.setValue(getDatabaseNode(), "addmonth", "number", getValue());
					end
					function onDoubleClick()
						Month = window.addmonth.getValue();
						
						CalendarManager.adjustMonths(Month);
						
						if window.checkweather.getValue() == 1 then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						if Year &gt; 0 then 
							CalendarManager.outputDate(); 
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)
					end
				</script>
			</number_ct_crosslink>
			<number_ct_crosslink name="addyear" source="addyear">
				<anchored to="addmonth" position="righthigh" offset="10" width="50" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_addyears_tooltip" />
				<script>
					function onInit()
						DB.setValue(getDatabaseNode(), "addyear", "number", getValue());
					end
					function onClose()
						DB.setValue(getDatabaseNode(), "addyear", "number", getValue());
					end
					function onDoubleClick()
						Year = window.addyear.getValue();
						
						if window.checkweather.getValue() == 1 then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						CalendarManager.adjustYears(Year);
						CalendarManager.outputDate();
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</number_ct_crosslink>
			
			<label name="addall">
				<anchored to="addminute" position="righthigh" offset="5" />
				<static textres="desktop_panel_add" />
				<tooltip textres="desktop_addall_tooltip" />
				<script>
					function onDoubleClick()
						Minute = window.addminute.getValue();
						Hour = window.addhour.getValue();
						Day = window.addday.getValue();
						
						if window.checkweather.getValue() == 1 then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						CalendarManager.adjustMinutes(Minute);
						CalendarManager.adjustHours(Hour);
						CalendarManager.adjustDays(Day);
						CalendarManager.outputDate();
						CalendarManager.outputTime();
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes)

					end
				</script>
			</label>
			
			<number_ct_crosslink name="uphour" source="uphour">
				<anchored to="addhour" width="20">
					<left anchor="left" offset="0" />
					<top to="addhour" anchor="bottom" offset="10" />
				</anchored>
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_uphour_tooltip" />
				<script>
				
					function onDoubleClick()
						setHour = window.uphour.getValue();
						currentHour = DB.getValue("calendar.current.hour", 0);
						Debug.console("setHour, currentHour", setHour, currentHour);
						if currentHour &lt; setHour then
							nDifference = setHour - currentHour;
							CalendarManager.adjustHours(nDifference);
						elseif currentHour &gt; setHour then
							nDifference = currentHour - setHour;
							CalendarManager.adjustHours(-nDifference);
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</number_ct_crosslink>
			<label name="timesep3">
				<anchored to="uphour" position="right" offset="5" />
				<color>FFFFFF</color>
				<static>:</static>
			</label>
			<number_ct_crosslink name="upminute" source="upminute">
				<anchored to="timesep3" position="right" offset="6" width="20" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_upminute_tooltip" />
				<script>
					function onDoubleClick()
						setMinute = window.upminute.getValue();
						currentMinute = DB.getValue("calendar.current.minute", 0);
						
						if currentMinute &lt; setMinute then
							nDifference = setMinute - currentMinute;
							CalendarManager.adjustMinutes(nDifference);
						elseif currentMinute &gt; setMinute then
							nDifference = currentMinute - setMinute;
							CalendarManager.adjustMinutes(-nDifference);
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</number_ct_crosslink>
			
			<number_ct_crosslink name="upday" source="upday">
				<anchored to="upminute" position="right" offset="38" width="20" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_upday_tooltip" />
				<script>
					function onDoubleClick()
						setDay = window.upday.getValue();
						currentDay = DB.getValue("calendar.current.day", 0);
						
						if currentDay &lt; setDay then
							nDifference = setDay - currentDay;
							CalendarManager.adjustDays(nDifference);
						elseif currentDay &gt; setDay then
							nDifference = currentDay - setDay;
							CalendarManager.adjustDays(-nDifference);
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</number_ct_crosslink>
			<number_ct_crosslink name="upmonth" source="upmonth">
				<anchored to="upday" position="right" offset="10" width="20" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_upmonth_tooltip" />
				<script>
					function onDoubleClick()
						setMonth = window.upmonth.getValue();
						currentMonth = DB.getValue("calendar.current.month", 0);
						
						if currentMonth &lt; setMonth then
							nDifference = setMonth - currentMonth;
							CalendarManager.adjustMonths(nDifference);
						elseif currentMonth &gt; setMonth then
							nDifference = currentMonth - setMonth;
							CalendarManager.adjustMonths(-nDifference);
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</number_ct_crosslink>
			<number_ct_crosslink name="upyear" source="upyear">
				<anchored to="upmonth" position="right" offset="10" width="50" />
				<font>calendarbold</font>
				<color>FFFFFF</color>
				<min>0</min>
				<tooltip textres="desktop_upyears_tooltip" />
				<script>
					function onDoubleClick()
						setYear = window.upyear.getValue();
						currentYear = DB.getValue("calendar.current.year", 0);
						
						if currentYear &lt; setYear then
							nDifference = setYear - currentYear;
							CalendarManager.adjustYears(nDifference);
						elseif currentYear &gt; setYear then
							nDifference = currentYear - setYear;
							CalendarManager.adjustYears(-nDifference);
						end
						onUpdate();
					end
					bTimeStep = false;
					function onUpdate()
						bTimeStep = true;
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</number_ct_crosslink>
			
			<label name="upall">
				<anchored to="upminute" position="right" offset="5" />
				<static textres="desktop_panel_up" />
				<tooltip textres="desktop_upall_tooltip" />
				<script>
					function onDoubleClick()
						CheckYears();
					end
					function CheckYears()
						window.upyear.onDoubleClick();
						CheckMonths();
					end
					function CheckMonths()
						window.upmonth.onDoubleClick();
						CheckDays();
					end
					function CheckDays()
						window.upday.onDoubleClick();
						CheckHours();
					end
					function CheckHours()
						window.uphour.onDoubleClick();
						CheckMinutes();
					end
					function CheckMinutes()
						window.upminute.onDoubleClick();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</label>
			
			<buttoncontrol name="adv6am">
				<anchored to="uphour" position="below" offset="5,10" height="20" />
				<icon normal="6AM_Dark" pressed="6AM_Dark_down" />
				<tooltip textres="desktop_adv6am_tooltip" />
				<script>
					function onButtonPress()
						local CurrentHour = DB.getValue("calendar.current.hour");
						local CurrentMinute = DB.getValue("calendar.current.minute");
						
						if CurrentHour &gt;= 6 then
							DB.setValue("calendar.current.hour", "number", 6);
							CalendarManager.adjustDays(1);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						elseif CurrentHour &lt; 6 then
							DB.setValue("calendar.current.hour", "number", 6);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						end
						if DB.getValue("calendar.check.day") == nil or DB.getValue("calendar.check.day") ~= DB.getValue("calendar.current.day") then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						CalendarManager.outputTime();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv12pm">
				<anchored to="adv6am" position="righthigh" offset="10,0" width="20" height="20" />
				<icon normal="12PM_Dark" pressed="12PM_Dark_down" />
				<tooltip textres="desktop_adv12pm_tooltip" />
				<script>
					function onButtonPress()
						local CurrentHour = DB.getValue("calendar.current.hour");
						local CurrentMinute = DB.getValue("calendar.current.minute");
						
						if CurrentHour &gt;= 12 then
							DB.setValue("calendar.current.hour", "number", 12);
							CalendarManager.adjustDays(1);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						elseif CurrentHour &lt; 12 then
							DB.setValue("calendar.current.hour", "number", 12);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						end
						if DB.getValue("calendar.check.day") == nil or DB.getValue("calendar.check.day") ~= DB.getValue("calendar.current.day") then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						CalendarManager.outputTime();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv6pm">
				<anchored to="adv12pm" position="righthigh" offset="10,0" width="20" height="20" />
				<icon normal="6PM_Dark" pressed="6PM_Dark_down" />
				<tooltip textres="desktop_adv6pm_tooltip" />
				<script>
					function onButtonPress()
						local CurrentHour = DB.getValue("calendar.current.hour");
						local CurrentMinute = DB.getValue("calendar.current.minute");
						
						if CurrentHour &gt;= 18 then
							DB.setValue("calendar.current.hour", "number", 18);
							CalendarManager.adjustDays(1);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						elseif CurrentHour &lt; 18 then
							DB.setValue("calendar.current.hour", "number", 18);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						end
						if DB.getValue("calendar.check.day") == nil or DB.getValue("calendar.check.day") ~= DB.getValue("calendar.current.day") then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						CalendarManager.outputTime();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv12am">
				<anchored to="adv6pm" position="righthigh" offset="10,0" width="20" height="20" />
				<icon normal="12AM_Dark" pressed="12AM_Dark_down" />
				<tooltip textres="desktop_adv12am_tooltip" />
				<script>
					function onButtonPress()
						local CurrentHour = DB.getValue("calendar.current.hour");
						local CurrentMinute = DB.getValue("calendar.current.minute");
						
						if CurrentHour &gt;= 0 then
							DB.setValue("calendar.current.hour", "number", 0);
							CalendarManager.adjustDays(1);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						elseif CurrentHour &lt; 0 then
							DB.setValue("calendar.current.hour", "number", 0);
							if CurrentMinute &gt;= 1 then
								DB.setValue("calendar.current.minute", "number", 0);
							end
						end
						if window.checkweather.getValue() == 1 then
							local WeatherWind = "Weather - Wind";
							local WeatherTemp = "Weather - Temperature";
							local WeatherRain = "Weather - Precipitation";
							TableManager.processTableRoll("", "Weather Wind");
							TableManager.processTableRoll("", "Weather Temperature");
							TableManager.processTableRoll("", "Weather Precipitation");
						end
						CalendarManager.outputTime();
						local nDateinMinutes = TimeManager.getCurrentDateinMinutes();
						DB.setValue("calendar.dateinminutes", "number", nDateinMinutes);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="openevents">
				<anchored to="adv12am" position="righthigh" offset="10,0" width="20" height="20" />
				<icon normal="add_logentry" pressed="add_logentry_down" />
				<tooltip textres="desktop_openevents_tooltip" />
				<script>
					function onButtonPress()
						if not Interface.findWindow("timedevents", "DB") then
							Interface.openWindow("timedevents", "DB");
						elseif Interface.findWindow("timedevents", "DB") then
							Interface.findWindow("timedevents", "DB").close();
						end
						
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="openreminders">
			<anchored to="openevents" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="reminder_button" pressed="reminder_button_down" />
				<tooltip textres="desktop_openreminders_tooltip" />
				<script>
					function onButtonPress()
						if not Interface.findWindow("timedreminders", "DB") then
							Interface.openWindow("timedreminders", "DB");
						elseif Interface.findWindow("timedreminders", "DB") then
							Interface.findWindow("timedreminders", "DB").close();
						end
						
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="opentravelmanager">
				<anchored to="openreminders" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip textres="desktop_opentravel_tooltip" />
				<script>
					function onButtonPress()
						if not Interface.findWindow("travelmanager", "DB") then
							Interface.openWindow("travelmanager", "DB");
						elseif Interface.findWindow("travelmanager", "DB") then
							Interface.findWindow("travelmanager", "DB").close();
						end
						
					end
				</script>
			</buttoncontrol>
			<button_checkbox name="checkweather">
				<anchored width="20" height="20">
					<top parent="opentravelmanager" anchor="top" offset="0" />
					<right parent="opentravelmanager" anchor="right" offset="20" />
				</anchored>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Check Weather on Time Adjust; NOTE: You must have a table for each 'Weather Wind', 'Weather Temperature', and 'Weather Precipitation'" />
				
			</button_checkbox>
		</sheetdata>
	</windowclass>

	<windowclass name="timedevents">
		<frame>groupbox</frame>
		<softclose />
		<placement>
			<size>
				<width>370</width>
				<height>30</height>
			</size>
			<position>
				<x>260</x>
				<y>30</y>
			</position>
		</placement>
		
		<sizelimits>
			<dynamic />
		</sizelimits>
		<nodelete />
		<script>
			
		</script>
		<sheetdata>
			<windowlist name="eventslist">
				<anchored>
					<top offset="15" />
					<left offset="15" />
					<right offset="-15" />
					<bottom offset="-15" />
				</anchored>
				<sortby><control>year</control><control>month</control><control>day</control><control>hour</control><control>minute</control></sortby>
				<child><backcolor>1A40301E</backcolor></child>
				<datasource>.timedeventlist</datasource>
				<class>list_timedevent</class>
				<acceptdrop>
					<class>timedevent</class>
					<class>list_timedevent</class>
					<class>referencetext</class>
					<class>referencetextwide</class>
					<field>*</field>
				</acceptdrop>
				<empty text="Right-click to add an event" hidereadonly="true" />
				<allowcreate />
				<allowdelete />
				<script>
					function onInit()
						DB.addHandler("calendar.dateinminutes", "onUpdate", onTimeChanged);
						onListChanged();
					end
					function onClose()
						DB.removeHandler("calendar.dateinminutes", "onUpdate", onTimeChanged);
					end
					function onTimeChanged()
						for _,w in pairs(getWindows()) do
							w.onTimeChanged();
						end
					end
					function update()
						onTimeChanged();
					end
					function onListChanged()
						for _,w in pairs(getWindows()) do
							w.onInit();
						end
					end
				</script>
			</windowlist>
			
			
			<scrollbar>
				<anchored to="eventslist" />
				<target>eventslist</target>
			</scrollbar>
		</sheetdata>
		<dynamic />
	</windowclass>
	
	
	
	
	
	


	<windowclass name="list_timedevent">
		<margins control="0,0,0,2" />
		<softclose />
		<script>
			function onInit()
				
			end
			
			function update()
				windowlist.update();
				if isgmonly.getValue() == 1 then
					if not User.isHost() == true then
						setVisible(false);
					end
				end
				completed.setValue(0);
			end
			function onTimeChanged()
				local nCurrentDateinMinutes = TimeManager.getCurrentDateinMinutes();
				local nMyMinute = minute.getValue();
				local nMyHour = hour.getValue();
				local nMyDay = day.getValue();
				local nMyMonth = month.getValue();
				local nMyYear = year.getValue();
				local Visible = isgmonly.getValue();
				local sName = name.getValue();
				local nCompleted = completed.getValue();
				local nHoursinMinutes = TimeManager.convertHourstoMinutes(nMyHour);
				local nDaysinMinutes = TimeManager.convertDaystoMinutes(nMyDay);
				local nMonthsinMinutes = TimeManager.convertMonthssnowtoMinutes(nMyMonth, nMyYear);
				local nYearsinMinutes = TimeManager.convertYearsnowtoMinutes(nMyYear);
				local nDateinMinutes = nHoursinMinutes + nDaysinMinutes + nMonthsinMinutes + nYearsinMinutes + nMyMinute;
				
				if Visible == 1 then
					bBoolean = true;
				elseif Visible == 0 then
					bBoolean = false;
				end
				if nCurrentDateinMinutes &gt;= nDateinMinutes then
					if nCompleted == 0 then
						local msg = {font = "reference-r", text = "[" .. nMyHour .. ":" .. nMyMinute .. "/" .. nMyDay .. "/" .. nMyMonth .. "/" .. nMyYear .. "] " .. sName .. "", secret = bBoolean};
						Comm.deliverChatMessage(msg);
						completed.setValue(1);
						if TableManager.findTable(sName) then
							TableManager.processTableRoll("", sName);
						end
					end
				elseif nCurrentDateinMinutes &lt; nDateinMinutes then
					completed.setValue(0);
				end
							
			end
		</script>
		<sheetdata>
			<genericcontrol name="rightanchor">
				<anchored width="0" height="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_idelete>
			<linkcontrol_id name="shortcut">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
				</anchored>
				<class>timedevent</class>
				<readonly />
			</linkcontrol_id>
			<buttonfield name="isgmonly">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityon" tooltipres="visibilityon" />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
			</buttonfield>
			<buttongroup_counter name="completedbutton">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<sourcefields>
					<current>completed</current>
				</sourcefields>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Completed" />
				
			</buttongroup_counter>
			<basicnumber name="completed" source="completed">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
				<invisible />
			</basicnumber>
			<basicnumber name="year" source="year">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
				<tooltip textres="year_tooltip" />
			</basicnumber>
			
			<basicnumber name="month" source="month">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
				<tooltip textres="month_tooltip" />
			</basicnumber>
			<basicnumber name="day" source="day">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
				<tooltip textres="day_tooltip" />
			</basicnumber>
			<basicnumber name="minute" source="minute">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
				<tooltip textres="minute_tooltip" />
			</basicnumber>
			<basicnumber name="hour" source="hour">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tooltip textres="hour_tooltip" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
			</basicnumber>
			<stringu name="name">
				<anchored height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
					<left offset="10" />
				</anchored>
				<color>000000</color>
				<tabtarget next="nonid_name" prev="count" />
			</stringu>
			
		</sheetdata>
	</windowclass>
	
	
	<windowclass name="timedevent">
		<frame>referencepage</frame>
		<placement>
			<size width="400" height="350" />
		</placement>
		<sizelimits>
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<tooltip field="value" />
		<softclose />
		<sharable />
		<script>
			nString = "";
			function onLockChanged()
				if header.subwindow then
					header.subwindow.update();
				end
				
				
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				text.setReadOnly(bReadOnly);
				hour.setReadOnly(bReadOnly);
				minute.setReadOnly(bReadOnly);
				day.setReadOnly(bReadOnly);
				month.setReadOnly(bReadOnly);
				year.setReadOnly(bReadOnly);
				nMonth = month.getValue();
				nDay = day.getValue();
				nYear = year.getValue();
				if bDone == nil then 
					bDone = false; 
				end
				if bDone == false then
					if bReadOnly == true then
						nString = text.getValue();
						TimeManager.addLogEntry(nMonth, nDay, nYear, nString);
						bDone = true;
					end
				end
			end
		</script>
		<sheetdata>
			<sub_record_header name="header">
				<class>timedevents_header</class>
			</sub_record_header>

			<frame_record_content name="contentframe" />
			<basicnumber name="hour" source="hour">
				<anchored width="20" height="20">
					<top parent="header" anchor="bottom" offset="10" />
					<left offset="80" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onValueChanged()
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<tooltip textres="hour_tooltip" />
			</basicnumber>
			
			<basicnumber name="minute" source="minute">
				<anchored to="hour" width="20" height="20">
					<top />
					<left parent="hour" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onValueChanged()
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<tooltip textres="minute_tooltip" />
			</basicnumber>
			<basicnumber name="day" source="day">
				<anchored to="minute" width="20" height="20">
					<top />
					<left parent="minute" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onValueChanged()
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<tooltip textres="day_tooltip" />
			</basicnumber>
			<basicnumber name="month" source="month">
				<anchored to="day" width="20" height="20">
					<top />
					<left parent="day" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onValueChanged()
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<tooltip textres="month_tooltip" />
			</basicnumber>
			<basicnumber name="year" source="year">
				<anchored to="month" width="40" height="20">
					<top />
					<left parent="month" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onValueChanged()
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<tooltip textres="year_tooltip" />
			</basicnumber>
			<buttonfield name="isgmonly">
				<anchored to="year" width="40" height="20">
					<top />
					<left parent="year" anchor="right" offset="10" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityon" tooltipres="visibilityon" />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
			</buttonfield>
			<buttoncontrol name="openlogentry">
				<anchored to="isgmonly" position="right" offset="3,0" width="20" height="20" />
				<icon normal="add_logentry" pressed="add_logentry_down" />
				<tooltip textres="desktop_openlog_tooltip" />
				<script>
					function onButtonPress()
						nMonth = window.month.getValue();
						nDay = window.day.getValue();
						nYear = window.year.getValue();
						sString = window.text.getValue();
						if window.isgmonly.getValue() == 1 then
							bGMVisible = true;
						elseif window.isgmonly.getValue() == 0 then
							bGMVisible = false;
						end
						
						TimeManager.addLogEntry(nMonth, nDay, nYear, bGMVisible, sString);
					end
				</script>
			</buttoncontrol>
			<button_text name="button_viewall">
				<anchored to="openlogentry" position="righthigh" offset="5,0" width="70" height="20" />
				<state text="View Logs" />
				<script>
					function onButtonPress()
						Interface.openWindow("loglist", "calendar.log");
					end
				</script>
			</button_text>

			<ft_record name="text">
				<anchored>
					<top offset="110" />
					<left offset="30" />
					<right offset="-30" />
					<bottom offset="-30" />
				</anchored>
				<empty textres="ft_empty" hidereadonly="true" />
			</ft_record>
			<scrollbar_record>
				<target>text</target>
			</scrollbar_record>
			
			<resize_referencepage />
			<close_referencepage />
		</sheetdata>
	</windowclass>
	
	
	<windowclass name="timedevents_header">
		<margins control="0,0,0,7" />
		<script>
			function onInit()
				update();
			end
			function update()
				
			end
		</script>
		<softclose />
		<sheetdata>
			<link_record_header>
				<class>timedevent</class>
				<description field="name" />
			</link_record_header>

			<anchor_record_header_right name="rightanchor" />
			<icon_record_locked />
			<button_record_locked />

			<string_record_name name="name" />
		</sheetdata>
	</windowclass>
	
	
	<windowclass name="travelmanager">
		<frame>groupbox</frame>
		<size width="500" height="90" />
		<placement>
			<position>
				<x>10</x>
				<y>30</y>
			</position>
		</placement>		
		<sizelimits>
			<size width="500" height="90" />
		</sizelimits>		
		<nodelete />
		<sheetdata>
			<label name="traveledlabel">
				<anchored position="insidetopleft" offset="10,10" height="20" width="70" />
				<font>calendarbold</font>
				<color>000000</color>
				<static text="Traveled" />
			</label>
			<label name="totallabel">
				<anchored to="traveledlabel" position="belowleft" offset="0,10" height="20" width="70" />
				<font>calendarbold</font>
				<color>000000</color>
				<static text="Distance:" />
			</label>
			<label name="remaininglabel">
				<anchored to="totallabel" position="belowleft" offset="0,10" height="20" width="70" />
				<font>calendarbold</font>
				<color>000000</color>
				<static text="Remaining:" />
			</label>
			<label name="travelspeedlabel">
				<anchored to="remaininglabel" position="belowleft" offset="0,10" height="20" width="70" />
				<font>calendarbold</font>
				<color>000000</color>
				<static text="Speed:" />
			</label>
			<label name="travelbylabel">
				<anchored to="travelspeedlabel" position="belowleft" offset="0,10" height="20" width="70" />
				<font>calendarbold</font>
				<color>000000</color>
				<static text="Travel by:" />
			</label>
			<simplenumber name="distanceremaining" source="distance.remaining">
				<anchored to="remaininglabel" position="righthigh" height="20" width="20" offset="5" />
				<tooltip text="Distance Remaining" />
				<script>
					function onInit()
						DB.addHandler("distance.traveled", "onUpdate", calculateDistanceRemaining);
						DB.addHandler("distance.destination", "onUpdate", calculateDistanceRemaining);
					end
					function onClose()
						DB.removeHandler("distance.traveled", "onUpdate", calculateDistanceRemaining);
						DB.removeHandler("distance.destination", "onUpdate", calculateDistanceRemaining);
					end
					function calculateDistanceRemaining()
						local nDistance = window.destination.getValue();
						local nDistanceTraveled = window.distancetraveled.getValue();
						local nDistanceRemaining = nDistance - nDistanceTraveled;
						setValue(nDistanceRemaining);
					end
					function onValueChanged()
						local nDistance = window.destination.getValue();
						local nDistanceTraveled = window.distancetraveled.getValue();
						nDistanceRemaining = nDistance - nDistanceTraveled;
						DB.setValue("distance.remaining", "number", nDistanceRemaining);
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<readonly />
			</simplenumber>
			
			<basicnumber name="distancetraveled" source="distance.traveled">
				<anchored to="traveledlabel" position="righthigh" height="20" width="20" offset="5" />
				<delaykeyupdate />
				<tooltip text="Distance Traveled" />
				<script>
					function onValueChanged()
						DB.setValue("distance.traveled", "number", getValue());
						window.travelprogress.update();
						onUpdate();
					end
					function onUpdate()
					end
				</script>
			</basicnumber>
			<basicnumber name="destination" source="distance.destination">
				<anchored to="totallabel" position="righthigh" height="20" width="20" offset="5" />
				<delaykeyupdate />
				<tooltip text="Total Travel Distance" />
				<script>
					function onValueChanged()
						DB.setValue("distance.destination", "number", getValue());
						window.travelprogress.update();
						onUpdate();
					end
					function onUpdate()
					end
				</script>
			</basicnumber>
			<buttoncontrol name="destinationmeasurement">
				<anchored height="30" width="60">
					<left parent="destination" anchor="right" offset="10" />
					<top parent="destination" anchor="top" />
				</anchored>
				<tooltip text="Distance in Miles/Kilometers" />
				<state text="Mile(s)" />
				<state text="Kilometer(s)" />
				<default>0</default>
				<sourcefields>
					<current>distance.speedunit</current>
				</sourcefields>
				<color>000000</color>
				<frame name="fielddark" offset="0,0,0,0" />
				<script>
					function onValueChanged()
						DB.setValue("distance.speedunit", "number", getValue());
						window.unitofmeasurement.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<basicnumber name="travelspeed" source="distance.speed">
				<anchored to="travelspeedlabel" position="righthigh" height="20" width="20" offset="5" />
				<tooltip text="Speed" />
				<delaykeyupdate />
				<default>6</default>
				<script>
					function onValueChanged()
						DB.setValue("distance.speed", "number", getValue());
						onUpdate();
					end
					function onUpdate()
					end
				</script>
			</basicnumber>
			
			
			<buttoncontrol name="unitofmeasurement">
				<anchored height="30" width="60">
					<left parent="travelspeed" anchor="right" offset="10" />
					<top parent="travelspeed" anchor="top" />
				</anchored>
				<state text="Mile(s)" />
				<state text="Kilometer(s)" />
				<default>0</default>
				<sourcefields>
					<current>distance.speedunit</current>
				</sourcefields>
				<color>000000</color>
				<frame name="fielddark" offset="0,0,0,0" />
				<tooltip text="Length Factor of Speed" />
				<script>
					function onValueChanged()
						DB.setValue("distance.speedunit", "number", getValue());
						window.destinationmeasurement.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="perlimit">
				<anchored height="30" width="60">
					<left parent="unitofmeasurement" anchor="right" offset="0" />
					<top parent="unitofmeasurement" anchor="top" />
				</anchored>
				<tooltip text="Time Factor of Speed" />
				<state text="/hour" />
				<state text="/day" />
				<default>0</default>
				<sourcefields>
					<current>distance.perlimit</current>
				</sourcefields>
				<color>000000</color>
				<frame name="fielddark" offset="0,0,0,0" />
				<script>
					
					function onValueChanged()
						DB.setValue("distance.perlimit", "number", getValue());
						window.traveltime.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<basicnumber name="travelbyhours" source="travel.byhours">
				<anchored to="travelbylabel" position="righthigh" height="20" width="20" offset="5" />
				<tooltip text="Travel by # of Hours/Days" />
				<delaykeyupdate />
				<script>
					function onDoubleClick()
						local bAllow = true;
						local nValue = getValue();
						local nDistanceTotaled = 0;
						local nTimePassed = 0;
						local nTravelCount = 0;
						if window.isgmonly.getValue() == 0 then
							isGMonly = false;
						elseif window.isgmonly.getValue() == 1 then
							isGMonly = true;
						end
						for i=1,nValue do
							Debug.console("travelbyhours; nValue = " .. nValue .. "");
							local nDistance = window.destination.getValue();
							local nDistanceTraveled = window.distancetraveled.getValue() + (window.travelspeed.getValue());
							local nTraveledBefore = window.distancetraveled.getValue();
							Debug.console("travelbyhours; nDistance = " .. nDistance .. "; nDistanceTraveled = " .. nDistanceTraveled .. "");
							if nDistance &gt; nTraveledBefore then
								if window.perlimit.getValue() == 0 then
									DaysorHours = "hours";
									CalendarManager.adjustHours(1);
								elseif window.perlimit.getValue() == 1 then
									DaysorHours = "days";
									CalendarManager.adjustDays(1);
								end
								nTimePassed = nTimePassed + 1;
								for i=1,window.travelspeed.getValue() do
									if nDistance &gt; window.distancetraveled.getValue() then
										nTravelCount = nTravelCount + 1;
										nDistanceTotaled = window.distancetraveled.getValue() + 1;
										window.distancetraveled.setValue(nDistanceTotaled);
									end
								end
							end
						end
						if window.perlimit.getValue() == 0 then
							DaysorHours = "hours";
						elseif window.perlimit.getValue() == 1 then
							DaysorHours = "days";
						end
						if window.unitofmeasurement.getValue() == 0 then
							MilesorKilometers = "miles";
						elseif window.unitofmeasurement.getValue() == 1 then
							MilesorKilometers = "kilometers";
						end
						
						local nDistance = window.destination.getValue();
						local nDistanceTraveled = window.travelspeed.getValue() * getValue();
						local nTraveledBefore = window.distancetraveled.getValue();
						if nDistance &gt; nTraveledBefore then
							local msg = {font = "reference-r", text = "The Party has traveled " .. nTravelCount .. " " .. MilesorKilometers .. " in " .. getValue() .. " " .. DaysorHours .. ". They have " .. window.distanceremaining.getValue() .. " " .. MilesorKilometers .. " left to go.", secret = isGMonly};
							Comm.deliverChatMessage(msg);
						elseif nDistance &lt;= nTraveledBefore then
							local msg = {font = "reference-r", text = "The Party has traveled " .. nTravelCount .. " " .. MilesorKilometers .. " in " .. nTimePassed .. " " .. DaysorHours .. " and has reached their destination", secret = isGMonly};
							Comm.deliverChatMessage(msg);
							local bAllow = false;
						end
					end
					
				</script>
			</basicnumber>
			<buttoncontrol name="traveltime">
				<anchored height="30" width="60">
					<left parent="travelbyhours" anchor="right" offset="0" />
					<top parent="travelbyhours" anchor="top" />
				</anchored>
				<tooltip text="" />
				<state text="hours" />
				<state text="days" />
				<default>0</default>
				<sourcefields>
					<current>distance.perlimit</current>
				</sourcefields>
				<color>000000</color>
				<script>
					
					function onValueChanged()
						DB.setValue("distance.perlimit", "number", getValue());
						window.perlimit.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<buttonfield name="isgmonly">
				<anchored height="20" width="50">
					<left parent="traveltime" anchor="right" offset="0" />
					<top parent="traveltime" anchor="top" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityon" tooltipres="visibilityon" />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
			</buttonfield>
			
			<label name="travellabel">
				<anchored to="travelbylabel" position="belowleft" offset="0,10" height="20" width="70" />
				<font>calendarbold</font>
				<color>000000</color>
				<static text="Travel" />
			</label>
			<buttoncontrol name="travel">
				<anchored to="travellabel" position="righthigh" offset="0,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip text="Travel" />
				<script>
					function onButtonPress()
						window.travelbyhours.onDoubleClick();
					end
				</script>
			</buttoncontrol>
			<!--<progressbar name="travelprogress">
				<anchored height="20" width="50">
					<left parent="travelbyhours" anchor="right" offset="10" />
					<top parent="travelbyhours" anchor="top" />
				</anchored>
				<source><max>destination</max><used>distancetraveled</used></source>
				<textprefix><text>distance</text></textprefix>
				<healthbar />
			</progressbar>-->
			
		</sheetdata>
	</windowclass>
	
	<windowclass name="timedreminders">
		<frame>groupbox</frame>
		<placement>
			<size>
				<width>370</width>
				<height>30</height>
			</size>
			<position>
				<x>260</x>
				<y>30</y>
			</position>
		</placement>
		
		<sizelimits>
			<dynamic />
		</sizelimits>
		<nodelete />
		<softclose />
		<script>
			
		</script>
		<sheetdata>
			<windowlist name="reminderslist">
				<anchored>
					<top offset="15" />
					<left offset="15" />
					<right offset="-15" />
					<bottom offset="-15" />
				</anchored>
				<sortby><control>name</control></sortby>
				<child><backcolor>1A40301E</backcolor></child>
				<datasource>.timedreminderlist</datasource>
				<class>list_timedreminder</class>
				<empty text="Right-click to add an reminder" hidereadonly="true" />
				<acceptdrop>
					<class>timedreminder</class>
					<class>list_timedreminder</class>
					<class>referencetext</class>
					<class>referencetextwide</class>
					<field>*</field>
				</acceptdrop>
				<allowcreate />
				<allowdelete />
				<script>
					function onInit()
						DB.addHandler("calendar.dateinminutes", "onUpdate", onTimeChanged);
						onListChanged();
					end
					function onClose()
						DB.removeHandler("calendar.dateinminutes", "onUpdate", onTimeChanged);
					end
					function onTimeChanged()
						for _,w in pairs(getWindows()) do
							w.onTimeChanged();
						end
					end
					function update()
						onTimeChanged();
					end
					function onListChanged()
						for _,w in pairs(getWindows()) do
							w.onInit();
						end
					end
				</script>
			</windowlist>
			
			
			<scrollbar>
				<anchored to="reminderslist" />
				<target>reminderslist</target>
			</scrollbar>
		</sheetdata>
		<dynamic />
	</windowclass>
	
	
	
	
	
	


	<windowclass name="list_timedreminder">
		<margins control="0,0,0,2" />
		<softclose />
		<script>
			function onInit()
				
			end
			
			function update()
				windowlist.update();
				if isgmonly.getValue() == 1 then
					if not User.isHost() == true then
						setVisible(false);
					end
				end
				completed.setValue(0);
			end
			function onTimeChanged()
				local rActor = ActorManager.resolveActor(getDatabaseNode());
				local nDate = CalendarManager.getCurrentDateString();
				local nTime = CalendarManager.getCurrentTimeString();
				local nDateAndTime = "" .. nTime .. " " .. nDate .. "";
				local nCurrentDateinMinutes = TimeManager.getCurrentDateinMinutes();
				local ReminderCycle = remindercycle.getValue();
				local RepeatTime = repeattime.getValue();
				local Visible = isgmonly.getValue();
				local sName = name.getValue();
				local nActive = active.getValue();
				if RepeatTime == 0 then
					Time = ReminderCycle;
				elseif RepeatTime == 1 then
					Time = (ReminderCycle * 60);
				elseif RepeatTime == 2 then
					Time = ((ReminderCycle * 60) * 24);
				end
				
				if Visible == 1 then
					bBoolean = true;
				elseif Visible == 0 then
					bBoolean = false;
				end
				Debug.console("" .. TimeManager.getTimeDifference(rActor, sName) .. "");
				if TimeManager.isTimeGreaterThan(rActor, sName, Time) then
					if nActive == 1 then
						local msg = {font = "reference-r", text = "[" .. nDateAndTime .. "] " .. sName .. "", secret = bBoolean};
						Comm.deliverChatMessage(msg);
						if TableManager.findTable(sName) then
							TableManager.processTableRoll("", sName);
						end
						TimeManager.setStartTime(rActor, sName);
					end
				end	
			end
		</script>
		<sheetdata>
			<genericcontrol name="rightanchor">
				<anchored width="0" height="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_idelete>
			<linkcontrol_id name="shortcut">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
				</anchored>
				<class>timedreminder</class>
				<readonly />
			</linkcontrol_id>
			<buttongroup_counter name="activebutton">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<sourcefields>
					<current>active</current>
				</sourcefields>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Active" />
				
			</buttongroup_counter>
			<basicnumber name="active" source="active">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<script>
					function onInit()
					end
					function onValueChanged()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sName = window.name.getValue();
						TimeManager.setStartTime(rActor, sName);
					end
				</script>
				<invisible />
			</basicnumber>
			<buttonfield name="isgmonly">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityon" tooltipres="visibilityon" />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
			</buttonfield>
			<basicnumber name="remindercycle" source="remindercycle">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
				<tooltip textres="remindercycle_tooltip" />
			</basicnumber>
			<buttoncontrol name="repeattimebutton" source="reminder.repeattime">
				<anchored width="60" height="30">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<tooltip text="Remind every number of minutes/hours/days" />
				<state text="minutes" />
				<state text="hours" />
				<state text="days" />
				<default>0</default>
				<sourcefields>
					<current>reminder.repeattime</current>
				</sourcefields>
				<color>000000</color>
				<script>
					function onInit()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						setValue(DB.getValue(nodeActor, "reminder.repeattime", 0));
					end
					function onButtonPress()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						DB.setValue(nodeActor, "reminder.repeattime", "number", getValue());
						window.repeattime.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<basicnumber name="repeattime" source="reminder.repeattime">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<script>
					function onInit()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						setValue(DB.getValue(nodeActor, "reminder.repeattime", 0));
					end
					function onValueChanged()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						DB.setValue(nodeActor, "reminder.repeattime", "number", getValue());
						window.repeattimebutton.setValue(getValue());
					end
				</script>
				<invisible />
			</basicnumber>
			<stringu name="name">
				<anchored height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
					<left offset="10" />
				</anchored>
				<color>000000</color>
				<tabtarget next="nonid_name" prev="count" />
			</stringu>
			
		</sheetdata>
	</windowclass>
	
	
	<windowclass name="timedreminder">
		<frame>referencepage</frame>
		<placement>
			<size width="400" height="350" />
		</placement>
		<sizelimits>
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<tooltip field="value" />
		<softclose />
		<sharable />
		<script>
			nString = "";
			function onLockChanged()
				if header.subwindow then
					header.subwindow.update();
				end
				
				
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				text.setReadOnly(bReadOnly);
				remindercycle.setReadOnly(bReadOnly);
				repeattime.setReadOnly(bReadOnly);
				isgmonly.setReadOnly(bReadOnly);
			end
		</script>
		<sheetdata>
			<sub_record_header name="header">
				<class>timedreminders_header</class>
			</sub_record_header>

			<frame_record_content name="contentframe" />
			<label name="reminderlabel">
				<anchored>
					<top parent="header" anchor="bottom" offset="10" />
					<left offset="40" />
				</anchored>
				<static text="Remind every" />
			</label>
			<basicnumber name="remindercycle" source="remindercycle">
				<anchored width="20" height="20">
					<top parent="header" anchor="bottom" offset="10" />
					<left parent="reminderlabel" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<script>
					function onValueChanged()
						onUpdate();
					end
					function onUpdate()
					end
				</script>
				<tooltip textres="remindercycle_tooltip" />
			</basicnumber>
			
			<basicnumber name="repeattime" source="reminder.repeattime">
				<anchored to="remindercycle" width="30" height="30">
					<top />
					<left parent="remindercycle" anchor="right" offset="10" />
				</anchored>
				<script>
					function onInit()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						setValue(DB.getValue(nodeActor, "reminder.repeattime", 0));
					end
					function onValueChanged()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						DB.setValue(nodeActor, "reminder.repeattime", "number", getValue());
						window.repeattimebutton.setValue(getValue());
					end
				</script>
				<invisible />
			</basicnumber>
			<buttoncontrol name="repeattimebutton" source="reminder.repeattime">
				<anchored to="repeattime" width="60" height="20">
					<top />
					<left parent="repeattime" anchor="right" offset="10" />
				</anchored>
				<tooltip text="Remind every number of minutes/hours/days" />
				<state text="minutes" />
				<state text="hours" />
				<state text="days" />
				<default>0</default>
				<sourcefields>
					<current>reminder.repeattime</current>
				</sourcefields>
				<color>000000</color>
				<script>
					function onInit()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						setValue(DB.getValue(nodeActor, "reminder.repeattime", 0));
					end
					function onButtonPress()
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
						DB.setValue(nodeActor, "reminder.repeattime", "number", getValue());
						window.repeattime.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<buttonfield name="isgmonly">
				<anchored to="repeattimebutton" width="40" height="20">
					<top />
					<left parent="repeattimebutton" anchor="right" offset="10" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityon" tooltipres="visibilityon" />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<script>
					function onInit()
					end
					function onValueChanged()
					end
				</script>
			</buttonfield>
			<ft_record name="text">
				<anchored>
					<top offset="110" />
					<left offset="30" />
					<right offset="-30" />
					<bottom offset="-30" />
				</anchored>
				<empty textres="ft_empty" hidereadonly="true" />
			</ft_record>
			<scrollbar_record>
				<target>text</target>
			</scrollbar_record>
			<playerowned />
			<resize_referencepage />
			<close_referencepage />
		</sheetdata>
	</windowclass>
	
	
	<windowclass name="timedreminders_header">
		<margins control="0,0,0,7" />
		<script>
			function onInit()
				update();
			end
			function update()
				
			end
		</script>
		<sheetdata>
			<link_record_header>
				<class>timedreminder</class>
				<description field="name" />
			</link_record_header>

			<anchor_record_header_right name="rightanchor" />
			<icon_record_locked />
			<button_record_locked />

			<string_record_name name="name" />
		</sheetdata>
	</windowclass>
</root>